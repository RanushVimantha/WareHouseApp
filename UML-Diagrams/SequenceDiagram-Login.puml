@startuml WareHouseApp_LoginSequence

skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true

actor "Admin User" as User
participant "Form1\n(Login Form)" as LoginForm
participant "Admin" as AdminObj
participant "DataAccess" as DataAccess
database "SQL Server\n(WarehouseDB)" as Database
participant "DashBoard\n(Main Form)" as Dashboard

autonumber

User -> LoginForm: Enter username & password
User -> LoginForm: Click "Login" button
activate LoginForm

LoginForm -> LoginForm: Validate input fields
note right
  - Check username not empty
  - Check password not empty
end note

alt Invalid Input
    LoginForm -> User: Show validation error message
    deactivate LoginForm
else Valid Input
    LoginForm -> AdminObj: Login(username, password)
    activate AdminObj
    
    AdminObj -> DataAccess: ExecuteQuery(sql, parameters)
    activate DataAccess
    note right
      SQL: SELECT UserID, [Password] 
      FROM Users 
      WHERE UserName = @user 
      AND Role = 'Admin'
    end note
    
    DataAccess -> Database: Open connection & execute query
    activate Database
    
    Database --> DataAccess: Return DataTable with results
    deactivate Database
    
    DataAccess --> AdminObj: Return DataTable
    deactivate DataAccess
    
    AdminObj -> AdminObj: Validate credentials
    note right
      - Check if exactly 1 row returned
      - Compare passwords
      - Set Id, UserName, Password fields
    end note
    
    alt Credentials Valid
        AdminObj --> LoginForm: Return true
        deactivate AdminObj
        
        LoginForm -> LoginForm: Hide login form
        
        LoginForm -> Dashboard: new DashBoard(userName)
        activate Dashboard
        
        Dashboard -> Dashboard: ConfigureDashboard()
        note right
          - Set up menu buttons
          - Style UI elements
        end note
        
        Dashboard -> Dashboard: ShowMainDash()
        Dashboard --> User: Display dashboard
        
        LoginForm -> User: Show dashboard form
        deactivate Dashboard
        deactivate LoginForm
        
    else Credentials Invalid
        AdminObj --> LoginForm: Return false
        deactivate AdminObj
        
        LoginForm -> User: Show "Invalid credentials" error
        LoginForm -> LoginForm: Clear password field
        deactivate LoginForm
    end
end

@enduml

